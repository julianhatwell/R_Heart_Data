{
    "collab_server" : "",
    "contents" : "<style>\n.small-code pre code {\n  font-size: 1em;\n}\n.footer {\n    color: black; background: #E8E8E8;\n    position: fixed; top: 90%;\n    text-align:center; width:100%;\n}\n.reveal h1, .reveal h2, .reveal h3 {\n  word-wrap: normal;\n  -moz-hyphens: none;\n}\n.midcenter {\n    position: fixed;\n    top: 50%;\n    left: 50%;\n}\n</style>\n\nAnalysis of the Heart Data\n==========================\nauthor: Aliyu Sambo, Kamau Maina, Julian Hatwell and Paul Carter\ndate: \nautosize: true\nfont-import: http://fonts.googleapis.com/css?family=Ubuntu\nfont-family: 'Ubuntu'\n\nIntroduction\n============\n```{r initial_load, echo=FALSE}\n# load data\nheart <- read.csv(\"Heart.csv\")\n\n# tidy data\nheart <- heart[, -1]\nnames(heart)[14] <- \"HDisease\"\n\n# partition\nset.seed(16)\nn <- nrow(heart)\nindex <- sample(n, round(n * 0.7))\nheart.train <- heart[index, ]\nheart.test <- heart[-index, ]\n```\n\n- Why we chose the heart data\n- Exploratory Data Analysis (EDA)\n- Pre-processing\n- Descriptive / Predictive Analyses\n\nEDA Data Summary\n============\nThere are `r nrow(heart)` rows and `r ncol(heart)` columns (excluding column X).\n\n<div align=\"center\">\n<img src=\"figure/heart_summary.png\" width=700 height=500>\n</div>\n\nEDA Categorical Variables\n=========================\n\n```{r aliyu_boxplots, echo=FALSE, fig.width=11, fig.height=8}\npar(mfrow=c(2,2))\nboxplot(Chol ~ Sex, data = heart, main=\"Gender & Chol\",col='beige')\nboxplot(MaxHR ~ HDisease, data = heart, col='azure', main=\"Heart Disease & MaxHR\")\nboxplot(Chol ~ HDisease, data = heart,col='aquamarine', main=\"Heart Disease & Chol\")\nboxplot(MaxHR ~ Fbs, data = heart, main=\"Blood Sugar & MaxHR\",col='antiquewhite')\n```\n\nEDA Distribution of numeric vars\n===================================\n\n```{r julian_explore_nums, echo=FALSE, fig.height=4, fig.width=4}\nlibrary(lattice)\nnum.vars <- c(\"Age\", \"RestBP\"\n              , \"Chol\", \"MaxHR\"\n              , \"Oldpeak\", \"Ca\")\n\nfor (var in num.vars) {\nd <- densityplot(~heart.train[[var]]\n                 , xlab = var)\nprint(d)\n}\n```\n\nEDA Multivariate Distribution\n=============================\n\n```{r kamau_ggpoint_with_colour, echo=FALSE, fig.width=11, fig.height=8}\nlibrary(ggplot2)\nggplot(heart, aes(Age, Chol, color = ChestPain)) +\n  geom_point(size=3) + \n  ggtitle(\"Chest Pain Relationship To Age and Cholesterol\")\n```\n\nPreprocessing\n=============\n1. Drop variable X and rename AtheroscleroticHDisease\n1. Recoding factors\n1. Partition the data into training and test\n1. Handling NA values in Thal variable\n1. Handling NA values in Ca variable\n1. Handling outlier in Chol variable\n1. Handling skew in Oldpeak variable\n1. Scaling numeric variables\n\nNA Values\n=========\n\n```{r paul_na_visualisation, echo=FALSE, fig.width=11, fig.height=8}\nimage(is.na(heart.train)\n      , main = \"Missing Values\"\n      , xlab = \"Observation\"\n      , ylab = \"\"\n      , xaxt = \"n\"\n      , yaxt = \"n\"\n      , bty = \"n\"\n      , col = c(\"cornflowerblue\"\n                   , \"black\")\n                   )\naxis(1, seq(0, 1, length.out = nrow(heart.train))\n     , 1:nrow(heart.train)\n     , col = \"white\"\n     )\naxis(2, seq(0, 1, length.out = length(names(heart.train)))\n     , names(heart.train)\n     , col = \"white\"\n     , las = 2)\n```\n\nHandling NA values in Thal variable\n===================================\n\n```{r paul_thal_na}\nlibrary(Hmisc) # impute with mean/mode etc.\nheart.train$Thal <- impute(heart.train$Thal, mode) # mode is \"normal\"\n```\n\nHandling NA values in Ca variable\n=================================\n\n```{r aliyu_na_ca_before}\nsum(is.na(heart.train$Ca)) # before\n```\n\nHandling NA values in Ca variable\n=================================\n\n```{r aliyu_na_ca_impute_knn}\nlibrary(VIM)\nheart.imputn <- heart.train[!is.na(heart.train$Ca),]\nimputn.rows <- nrow(heart.imputn)\nheart.NA <- heart.train[is.na(heart.train$Ca),]\nheart.imp.NA <- rbind(heart.imputn, heart.NA)\n\nhearttemp <-kNN(heart.imp.NA, \"Ca\")[,-15]\n\ntoputback <- hearttemp[-c(1:imputn.rows), ]\nheart.train <- heart.train[!is.na(heart.train$Ca),]\nheart.train <- rbind(heart.train, toputback)\n```\n\nHandling NA values in Ca variable\n=================================\n```{r aliyu_na_ca_after}\nsum(is.na(heart.train$Ca)) # after\n```\n\nHandling outlier in Chol variable\n=================================\n\n<div class=\"footer\" style=\"margin-top:-50px;font-size:80%;\">\nThe Chol data has an outlier that is far removed from the next closest data point. This may have been an input error. It was therefore excluded from the analysis.</div>\n```{r, echo=FALSE}\nlibrary(\"ggplot2\")\n\ncholmax = which.max(heart$Chol)\nheart.clean=heart[-cholmax,]\n\nggplot(heart, aes(Chol)) +  geom_density(color=\"red\", size=1.25) + ggtitle(\"Cholesterol Levels With An Outlier\")\n```\n***\n```{r, echo=FALSE}\nggplot(heart.clean, aes(Chol)) +  geom_density(color=\"red\", size=1) + ggtitle(\"Choleserol Outlier Excluded\")\n```\n\nHandling skew in Oldpeak variable\n=================================\n```{r julian_transform_oldpeak, echo=FALSE, fig.height=4, fig.width=4}\ndensityplot(~Oldpeak\n            , data = heart.train\n            , main = \"Raw\")\ndensityplot(~sqrt(Oldpeak)\n            , data = heart.train\n            , main = \"Square Root\")\nlibrary(car)\nlambda <- coef(powerTransform(heart$Oldpeak + 0.1)) # car package, BC power strictly positive, not zero\ndensityplot(~I(Oldpeak^lambda)\n            , data = heart.train\n            , main = \"Box Cox Power Transform\")\n```\n\nWe chose square root as it is good enough and easier to explain to non-statisticians.\n\nPredictive and Descriptive Analyses\n===================================\n\nEach team member will now present a summary of their individual investigation\n\nUsing Clustering to Investigate the link between Heart Disease and Chest Pain\n============================\nJulian Hatwell\n\nHeart Disease and Chest Pain\n============================\n<div align=\"center\">\n<img src=\"figure/assoc_stats.png\" width=850 height=600>\n</div>\n\nHeart Disease and Chest Pain\n============================\n- Question: Is there an underlying set of metabolic indicators associated with the pattern seen in the symptoms?\n\n- Methodology: Remove the two variables describing the symptoms and use clustering to look for a pattern in the remaining variables.\n\n- $k \\in \\{2, 4\\}$ or dendrogram cut at 2 or 4 nodes makes sense intuitively.\n\nHeart Disease and Chest Pain\n============================\n<div align=\"center\">\n<img src=\"figure/hclus_and_plots_4.png\" width=600 height=600>\n</div>\n\nHeart Disease and Chest Pain\n============================\n<div align=\"center\">\n<img src=\"figure/hclus_and_plots_5.png\" width=600 height=600>\n</div>\n\nHeart Disease and Chest Pain\n============================\n<div align=\"center\">\n<img src=\"figure/hclus_align_results.png\" width=600 height=600>\n</div>\n\nHeart Disease and Chest Pain\n============================\n<div align=\"center\">\n<img src=\"figure/hclus_diagnostic_table.png\" width=700 height=600>\n</div>\n\nUsing Clustering to Investigate the link between Blood Sugar and Cholesterol\n=============================\nKamau Maina\n\nInitial Visualisation\n========================================================\n<div class=\"footer\" style=\"margin-top:-40px;font-size:80%;\">\nTo understand the Fasting Blood Sugar date.<br>\nFalse: Fastin Blood Sugar level below 120 mg/dl<br>\nTrue: Fasting Blood Sugar level above 120 mg/dl</div>\n```{r, echo=FALSE, fig.align='center'}\nlibrary(\"fpc\")\nlibrary(\"VIM\")\nlibrary(\"NbClust\")\n\nheart.ana = heart.clean[,c(1,2,4,5,6,14)]\nheart.ana$Sex = factor(heart.ana$Sex)\nlevels(heart.ana$Sex) = c(\"Female\", \"Male\")\nheart.ana$Fbs = factor(heart.ana$Fbs)\nlevels(heart.ana$Fbs) = c(\"False\", \"True\")\n\nggplot(heart.ana, aes(Sex, Chol, color=Fbs)) + geom_point(size=2) + \n  facet_wrap(~ HDisease) + ggtitle(\"Data Classes Relationships\")\n```\n\nK-Means Clustering\n========================================================\n<div>\n<div align=\"center\">\n<img src=\"presentation/Heart-figure/KM_CholFbsHDisease.png\">\n</div>\n***\n<div align=\"center\">\n<img src=\"presentation/Heart-figure/KM_CholFbsClust.png\">\n</div>\n</div>\n<div class=\"footer\" style=\"margin-top:-50px;font-size:80%;\">\nK-Means clustering clusters the data into different groups as the actual groups. This suggests that there is more that causes heart disease besides the variables at our disposal.\n</div>\n\n\nHierarchical Clustering\n=======================\n<div align=\"center\">\n<img src=\"presentation/Heart-figure/KM_CirclizedDendo.png\" height 550>\n</div>\n4 selected clusters are colored. Datum are colored by heart disease.\n\nVariable Density Heatmap\n========================\n<div align=\"center\">\n<img src=\"presentation/Heart-figure/KM_DendoHeatmap.png\" height=550>\n</div>\nA heatmap of the density of each unique datum per variable\n\nPrediction of Blood Sugar Levels - a class imbalance problem\n=======================\nAliyu Sambo\n\nInitial Naive Bayes Predictive Analysis Result\n==============================================\n\nInitial Naive Bayes prediction performance for Fbs (Fasting Blood Sugar) was poor.\n\n<div align=\"center\">\n<img src=\"ali/AS_NB_1.png\" height=450>\n</div>\n\nInitial kNN  Predictive Analysis Result\n=======================================\n\nkNN model prediction for Fbs showed very poor performance and predict all as false.\n\n<div align=\"center\">\n<img src=\"ali/AS_knn_1.png\" height=400>\n</div>\n\nImprovement Efforts\n===================\n\nFeature Selection: The RELIEF and RELIEFCAT algorithms were used to identify features that features that were key.\n\n<div align=\"center\">\n<img src=\"ali/AS_IMFS_1.png\" height=300>\n</div>\n\nUsing only key attributes did not give significant difference.\n\nImprovement Efforts (Contd)\n===========================\n\n- Optimising K parameter \n\n```{R}\nround(sqrt(nrow(heart.train)))\n```\n\nTherefore tried k= c(7, 9, 11, 13, 15, 17, 19). k=13 was used.\n\n- Rescaling of Numeric Attribute\n- Binning of Numeric Attributes and apply knncat (knn categorical)\n\nIdentified Main Cause of Poor Performance\n=========================================\n\n'Class Imbalance' of Fbs identified. \nIdeal for predictive models is close to 50% by 50%.\n\n```{r}\ntable(heart$Fbs)\ntable(heart$HDisease)\n```\n\nSolution\n========\nThere are two class imbalance mitigation approaches:\n- Cost function based approaches\n- Sampling based approaches: Oversampling/Undersampling/Hybrid\n\nOversampling (adding more of the minority class) was implemented using a function in ROSE package.\n\n<div align=\"left\">\n<img src=\"ali/AS_Os_1.png\" height=200>\n</div>\n\nResult After Mitigating for Class Imbalance\n===========================================\n<div align=\"center\">\n<img src=\"ali/AS_Fin_1.png\" height=550>\n</div>\n\nIncreasing classifier performance using data categorisation\n==============\nPaul Carter\n\nNaiveBayes with \"Raw\" Heart Dataset \n===================================\n<div align=\"center\">\n<img src=\"PaulPres/Images/paul_confusion.png\" width=400 height=500> <br />\n</div>\n\nCategorising Variables \n======================\nNow let's see if the performance is better with other categorised columns \n\n- Age from 41 values => 7 (<40, {41-46}, {47-52}, {53-58}, {59-64}, {65-70}, 71+)\n- RestBP from 50 Values => 4 (Low, Ideal, Pre-High & High)\n- Chol from 152 Values => 3 (Desirable, Borderline-High, High)\n- MaxHR from 91 Values => 2 (Average, High)\n\n=========================================================\n\n<div align=\"center\">\n<img src=\"PaulPres/Images/paul_MaxHR.png\" width= 800 height=500>\n</div>\n\n\nCategorising Variables 2\n========================\n\n<div align=\"center\">\n<img src=\"PaulPres/Images/paul_PieHeart.png\" width=400 height=350>\n<img src=\"PaulPres/Images/paul_PieCat.png\" width=400 height=350>\n</div>\n\n- A fully categorised RestBP variable \n\n\nAnalysing NaiveBayes\n====================\n```{r eval=FALSE}\nNBClassifier.alt <- naiveBayes(HDisease ~., data = NBdata3)\nNBClassifier.alt\n```\n<div align=\"center\">\n<img src=\"PaulPres/Images/paul_NBAge.png\" width=1200 height=200>\n</div>\n\n- Those aged between 53-58 are at the highest risk of developing heart disease\n\nAnalysing Results 2\n===================\n<div align=\"center\">\n<img src=\"PaulPres/Images/paul_NBSex.png\" width=250 height=100> \n<img src=\"PaulPres/Images/paul_NBChestPain.png\" width=500 height=100>  \n<img src=\"PaulPres/Images/paul_NBRestBP.png\" width=500 height=100> \n<img src=\"PaulPres/Images/paul_NBChol.png\" width=500 height=100> \n<img src=\"PaulPres/Images/paul_NBMaxHR.png\" width=300 height=100> \n<img src=\"PaulPres/Images/paul_NBThal.png\" width=400 height=100> \n</div>\n\n\nCategorising Results (NaiveBayes)\n=================================\n\n```{r eval=FALSE}\n```\n\n<div align=\"center\">\n<img src=\"PaulPres/Images/paul_confusion.png\" width=350 height=400>\n<img src=\"PaulPres/Images/paul_confusion3.png\" width=350 height=400>\n</div>\n\n- Decreased Accuracy\n- Higher Sensitivity \n\nKNN Results \n===========\n- KNN improved performance against \"raw\" heart data set (72.1%)\n- However performed worse against NaiveBayes\n\n<div align=\"center\">\n<img src=\"PaulPres/Images/paul_confusion3.png\" width=300 height=400>\n<img src=\"PaulPres/Images/paul_confusion4.png\" width=300 height=400>\n</div>\n\n\nConverting KNN to Integer + Rescaling \n=====================================\n\n<div align=\"center\">\n<img src=\"PaulPres/Images/paul_confusion6.png\" width=400 height=500>\n</div>\n\nFeature Selection\n=================\n```{r eval=FALSE}\nlibrary(mlbench)\nweights <- chi.squared(HDisease~., KNNdata3)\nprint(weights)\n```\n\n<div align=\"center\">\n<img src=\"PaulPres/Images/paul_FeatureSel.png\" width=800 height=50>\n</div>\n\n<div align=\"center\">\n<img src=\"PaulPres/Images/paul_confusion7.png\" width=250 height=300>\n</div>\n\nFinal Words\n===========\n\nAny Questions?\n\nThanks for your attention",
    "created" : 1481231224788.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2339618829",
    "id" : "4BBF2DA8",
    "lastKnownWriteTime" : 1481240545,
    "last_content_update" : 1481240545367,
    "path" : "C:/Dev/Study/R/BCU_Assignment_Final/Heart_Final.Rpres",
    "project_path" : "Heart_Final.Rpres",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_presentation"
}